<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Admin Delete</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #2d5a2d; }
        .error { background: #5a2d2d; }
        .info { background: #2d4a5a; }
        button {
            background: #e50914;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #f40612; }
        .debug {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Admin Delete Issue</h1>
    
    <div class="container">
        <h2>Step 1: Check Current User</h2>
        <button onclick="checkCurrentUser()">Check Current User</button>
        <div id="userInfo" class="debug"></div>
    </div>

    <div class="container">
        <h2>Step 2: Test Video Deletion</h2>
        <button onclick="testVideoDeletion()">Test Video Deletion</button>
        <div id="deleteResult" class="debug"></div>
    </div>

    <div class="container">
        <h2>Step 3: Login as Admin</h2>
        <p>If you're not logged in as admin, use these credentials:</p>
        <p><strong>Email:</strong> admin@example.com</p>
        <p><strong>Password:</strong> (your admin password)</p>
        <button onclick="loginAsAdmin()">Login as Admin</button>
        <div id="loginResult" class="debug"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        
        function addDebug(message, elementId) {
            const element = document.getElementById(elementId);
            element.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }

        async function checkCurrentUser() {
            const element = document.getElementById('userInfo');
            element.textContent = '';
            
            try {
                addDebug('Checking current user...', 'userInfo');
                
                const token = localStorage.getItem('token');
                if (!token) {
                    addDebug('‚ùå No token found in localStorage', 'userInfo');
                    addDebug('Please login first', 'userInfo');
                    return;
                }

                addDebug('Token found: ' + token.substring(0, 50) + '...', 'userInfo');

                const response = await fetch(`${API_BASE_URL}/auth/profile`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    addDebug('‚úÖ User profile loaded successfully', 'userInfo');
                    addDebug('User details:', 'userInfo');
                    addDebug(JSON.stringify(data.data.user, null, 2), 'userInfo');
                    
                    const user = data.data.user;
                    if (user.role === 'admin') {
                        addDebug('‚úÖ User is ADMIN - can delete videos', 'userInfo');
                    } else {
                        addDebug('‚ùå User is NOT admin - cannot delete videos', 'userInfo');
                        addDebug('Role: ' + user.role, 'userInfo');
                    }
                } else {
                    addDebug('‚ùå Failed to get user profile: ' + data.message, 'userInfo');
                }
            } catch (error) {
                addDebug('‚ùå Error: ' + error.message, 'userInfo');
            }
        }

        async function testVideoDeletion() {
            const element = document.getElementById('deleteResult');
            element.textContent = '';
            
            try {
                addDebug('Testing video deletion...', 'deleteResult');
                
                const token = localStorage.getItem('token');
                if (!token) {
                    addDebug('‚ùå No token found - please login first', 'deleteResult');
                    return;
                }

                // Get a video to delete
                const videosResponse = await fetch(`${API_BASE_URL}/videos?page=1&limit=1`);
                const videosData = await videosResponse.json();
                
                if (!videosData.success || videosData.data.videos.length === 0) {
                    addDebug('‚ùå No videos found to delete', 'deleteResult');
                    return;
                }

                const video = videosData.data.videos[0];
                addDebug('Found video: ' + video.title + ' (' + video._id + ')', 'deleteResult');

                // Try to delete the video
                const deleteResponse = await fetch(`${API_BASE_URL}/videos/${video._id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const deleteData = await deleteResponse.json();
                
                addDebug('Delete response status: ' + deleteResponse.status, 'deleteResult');
                addDebug('Delete response data:', 'deleteResult');
                addDebug(JSON.stringify(deleteData, null, 2), 'deleteResult');

                if (deleteResponse.ok) {
                    addDebug('‚úÖ Video deleted successfully!', 'deleteResult');
                } else {
                    addDebug('‚ùå Video deletion failed', 'deleteResult');
                }
            } catch (error) {
                addDebug('‚ùå Error: ' + error.message, 'deleteResult');
            }
        }

        async function loginAsAdmin() {
            const element = document.getElementById('loginResult');
            element.textContent = '';
            
            try {
                addDebug('Attempting to login as admin...', 'loginResult');
                
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@example.com',
                        password: prompt('Enter admin password:')
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    addDebug('‚úÖ Admin login successful!', 'loginResult');
                    addDebug('User details:', 'loginResult');
                    addDebug(JSON.stringify(data.data.user, null, 2), 'loginResult');
                    
                    // Store the token
                    localStorage.setItem('token', data.data.token);
                    addDebug('Token stored in localStorage', 'loginResult');
                    
                    // Check if user is admin
                    if (data.data.user.role === 'admin') {
                        addDebug('‚úÖ Confirmed: User is ADMIN', 'loginResult');
                    } else {
                        addDebug('‚ùå Warning: User role is ' + data.data.user.role, 'loginResult');
                    }
                } else {
                    addDebug('‚ùå Login failed: ' + data.message, 'loginResult');
                }
            } catch (error) {
                addDebug('‚ùå Error: ' + error.message, 'loginResult');
            }
        }

        // Auto-check user on page load
        window.addEventListener('load', () => {
            addDebug('Page loaded - checking current user...', 'userInfo');
            checkCurrentUser();
        });
    </script>
</body>
</html>
